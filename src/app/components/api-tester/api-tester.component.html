<div class="api-tester">
  <div class="header">
    <h1 class="title">🌐 API Tester</h1>
    <p class="subtitle">Test and debug HTTP requests with ease</p>
  </div>

  <!-- Saved APIs Section -->
  <div class="saved-apis-section">
    <div class="saved-apis-header">
      <h3>💾 Saved APIs</h3>
      <div class="saved-apis-actions">
        <div class="search-input-group">
          <input
            [(ngModel)]="searchQuery"
            (input)="searchSavedApis()"
            placeholder="🔍 Search saved APIs..."
            class="search-input"
          />
          <button
            *ngIf="searchQuery"
            (click)="clearSearch()"
            class="clear-search-btn"
          >
            ✖️
          </button>
        </div>
        <button
          (click)="openSaveDialog()"
          class="btn btn-secondary"
          [disabled]="!url"
        >
          💾 Save Current API
        </button>
      </div>
    </div>
    
    <div class="saved-apis-list" *ngIf="savedApis.length > 0">
      <div
        *ngFor="let api of savedApis"
        class="saved-api-item"
        (click)="loadSavedApi(api)"
      >
        <div class="api-info">
          <div class="api-name">{{ api.name }}</div>
          <div class="api-details">
            <span class="method-badge" [class]="'method-' + api.method.toLowerCase()">
              {{ api.method }}
            </span>
            <span class="api-url">{{ api.url }}</span>
          </div>
          <div class="api-description" *ngIf="api.description">
            {{ api.description }}
          </div>
          <div class="api-date">
            Created: {{ formatDate(api.createdAt) }}
          </div>
        </div>
        <button
          (click)="deleteSavedApi(api.id); $event.stopPropagation()"
          class="delete-api-btn"
          title="Delete API"
        >
          🗑️
        </button>
      </div>
    </div>
    
    <div *ngIf="savedApis.length === 0" class="empty-saved-apis">
      <p>No saved APIs yet. Save your first API above!</p>
    </div>
  </div>

  <form class="request-form" (ngSubmit)="sendRequest()" #form="ngForm">
    <div class="form-row">
      <div class="form-group method">
        <label class="form-label" for="method">Method</label>
        <select class="form-select" id="method" [(ngModel)]="method" name="method">
          <option value="GET">GET</option>
          <option value="POST">POST</option>
          <option value="PUT">PUT</option>
          <option value="PATCH">PATCH</option>
          <option value="DELETE">DELETE</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label" for="url">URL</label>
        <input 
          class="form-input"
          type="url" 
          id="url"
          [(ngModel)]="url" 
          name="url" 
          placeholder="https://api.example.com/endpoint"
          required 
        />
      </div>
    </div>

    <div class="headers-section">
      <label class="form-label">Headers</label>
      <div class="headers-container">
        <div class="header-row" *ngFor="let header of headers; let i = index">
          <input 
            class="header-input"
            type="text"
            placeholder="Header name" 
            [(ngModel)]="header.key" 
            [name]="'headerKey' + i"
          />
          <input 
            class="header-input"
            type="text"
            placeholder="Header value" 
            [(ngModel)]="header.value" 
            [name]="'headerValue' + i"
          />
          <button 
            type="button" 
            class="btn btn-remove btn-small"
            (click)="removeHeader(i)"
            [attr.aria-label]="'Remove header ' + (i + 1)"
          >
            Remove
          </button>
        </div>
        <div class="action-bar">
          <button 
            type="button" 
            class="btn btn-secondary btn-small"
            (click)="addHeader()"
          >
            + Add Header
          </button>
        </div>
      </div>
    </div>

    <div class="form-group" *ngIf="method !== 'GET' && method !== 'DELETE'">
      <label class="form-label" for="body">Request Body (JSON)</label>
      <textarea 
        class="form-textarea"
        id="body"
        [(ngModel)]="body" 
        name="body"
        placeholder='{"key": "value"}'
      ></textarea>
    </div>

    <div class="action-bar">
      <button 
        type="submit" 
        class="btn btn-primary" 
        [disabled]="!form.form.valid || isLoading"
      >
        <span *ngIf="!isLoading">🚀 Send Request</span>
        <span *ngIf="isLoading">⏳ Sending...</span>
      </button>
    </div>
  </form>

  <div class="error-message" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <div class="response-section" *ngIf="response !== null; else emptyState">
    <div class="response-header">
      <h2 class="response-title">Response</h2>
      <span class="status-badge" 
            [class.status-success]="status >= 200 && status < 300"
            [class.status-warning]="status >= 300 && status < 400"
            [class.status-error]="status >= 400">
        Status: {{ status }}
      </span>
    </div>
    
    <div class="response-container">
      <div class="response-content">
        <pre class="response-pre">{{ response | json }}</pre>
      </div>
    </div>
  </div>

  <ng-template #emptyState>
    <div class="empty-state">
      <span class="emoji">🚀</span>
      <h3>Ready to test</h3>
      <p>Enter a URL and click "Send Request" to get started</p>
    </div>
  </ng-template>

  <!-- Save API Dialog -->
  <div class="modal-overlay" *ngIf="showSaveDialog" (click)="closeSaveDialog()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>💾 Save API</h3>
        <button (click)="closeSaveDialog()" class="close-btn">✖️</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">API Name *</label>
          <input
            [(ngModel)]="saveApiName"
            placeholder="e.g., Get User Profile"
            class="form-input"
            required
          />
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea
            [(ngModel)]="saveApiDescription"
            placeholder="Optional description..."
            class="form-textarea"
            rows="3"
          ></textarea>
        </div>
        <div class="api-preview">
          <strong>Preview:</strong><br>
          <span class="method-badge" [class]="'method-' + method.toLowerCase()">{{ method }}</span>
          {{ url }}
        </div>
      </div>
      <div class="modal-footer">
        <button (click)="closeSaveDialog()" class="btn btn-secondary">Cancel</button>
        <button 
          (click)="saveCurrentApi()" 
          class="btn btn-primary"
          [disabled]="!saveApiName.trim()"
        >
          Save API
        </button>
      </div>
    </div>
  </div>
</div>